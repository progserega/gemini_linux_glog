# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Apparmor –≤ Debian 12
–°—Ç–∞—Ç—å–∏ –ø–æ —Ç–µ–º–µ:
=>https://help.ubuntu.ru/wiki/—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ_–ø–æ_ubuntu_server/–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å/apparmor 
=>https://vasilisc.com/rules_apparmor

## –õ–æ–≥–∏–∫–∞
1. –°—Ç–∞–≤–∏–º –Ω–∞–±–æ—Ä —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π, —á—Ç–æ–±—ã –±—ã–ª–æ –æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã:
```
apt-get install apparmor-profiles
```
2. –ö–æ–ø–∏—Ä—É–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å (—Å–ª—ç—à–∏ –∑–∞–º–µ–Ω—è–µ–º —Ç–æ—á–∫–∞–º–∏, –∏–º—è –ø—Ä–æ—Ñ–∏–ª—è - –ø—É—Ç—å –∫ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º–æ–º—É –±–∏–Ω–∞—Ä–Ω–∏–∫—É):
```
cp /etc/apparmor.d/usr.lib.unreal /etc/apparmor.d/opt.Unigine_Superposition-1.1.Superposition
```
3. –ü—Ä–∞–≤–∏–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ñ–∏–ª—è.
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º apparmor, —Å–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏:
```
systemctl reload apparmor; journalctl -af _TRANSPORT=audit
```
5. –ó–∞–ø—É—Å–∫–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É, —Å–º–æ—Ç—Ä–∏–º —á—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö - —É—á–∏—Ç—ã–≤–∞–µ–º, —á—Ç–æ –µ—Å–ª–∏ —Ä—É–≥–∞–µ—Ç—Å—è, —á—Ç–æ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –∑–∞–ø—É—Å–∫–∞ (x),
—Ç–æ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –±—É–¥–µ–º –ø–∏—Å–∞—Ç—å 'ix', –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ 'x' (—Å–º. –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞).
6. –ø–æ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è —à—Ä–∏—Ñ—Ç–æ–≤, –∑–≤—É–∫–∞ –∏ —Ç.–ø. —Ç–∏–ø–∞:
```
#include <abstractions/fonts>
#include <abstractions/X>
#include <abstractions/audio>
```
7. –ü–æ —Ç–∞–±–ª–∏—Ü–µ "–ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞" –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤ –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã, –ø–æ–ª—å–∑—É–µ–º—Å—è —Ç–∞–±–ª–∏—Ü–µ–π —à–∞–±–ª–æ–Ω–æ–≤ (—Å–º. –Ω–∏–∂–µ), –∞ —Ç–∞–∫ –∂–µ 
—Å–æ–∫—Ä–∞—â–µ–Ω–∏—è–º–∏ –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Ç–∏–ø–∞ home, sys (—Å–º. –ø—Ä–∏–º–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è –Ω–∏–∂–µ).

## –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```
journalctl -af _TRANSPORT=audit
```
–≤—ã–≤–æ–¥:
```
–∞–ø—Ä 02 18:39:24 sky audit[2103119]: AVC apparmor="STATUS" operation="profile_replace" info="same as current profile, skipping" profile="unconfined" name="/usr/lib/NetworkManager/nm-dhcp-client.action" pid=2103119 comm="apparmor_parser"
–∞–ø—Ä 02 18:39:24 sky audit[2103119]: AVC apparmor="STATUS" operation="profile_replace" info="same as current profile, skipping" profile="unconfined" name="/usr/lib/NetworkManager/nm-dhcp-helper" pid=2103119 comm="apparmor_parser"
–∞–ø—Ä 02 18:39:24 sky audit[2103119]: AVC apparmor="STATUS" operation="profile_replace" info="same as current profile, skipping" profile="unconfined" name="/usr/lib/connman/scripts/dhclient-script" pid=2103119 comm="apparmor_parser
```

## –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞:

* 'r' - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞.
* 'w' - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞.
* 'a' - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞ ‚Äì –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –¥–æ–ø–∏—Å—ã–≤–∞—Ç—å
–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Ñ–∞–π–ª (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –ª–æ–≥-—Ñ–∞–π–ª–æ–≤!). 
* 'px' - –ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–¥ —Å–≤–æ–∏–º –ø—Ä–æ—Ñ–∏–ª–µ–º. –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ—Ç, —Ç–æ –∑–∞–ø—É—Å–∫
–ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–ø—Ä–µ—â–µ–Ω. 
* 'Px' - –ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–¥ —Å–≤–æ–∏–º –ø—Ä–æ—Ñ–∏–ª–µ–º, –ø—Ä–∏ —ç—Ç–æ–º AppArmor –æ—á–∏—â–∞–µ—Ç
–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ—Ç, —Ç–æ –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–ø—Ä–µ—â–µ–Ω. 
* 'ix' - –ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –ø–æ–¥ –ø—Ä–æ—Ñ–∏–ª–µ–º —Ç–µ–∫—É—â–µ–≥–æ. 
* 'm' - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –≤ –ø–∞–º—è—Ç—å –∏ –µ–≥–æ –∑–∞–ø—É—Å–∫–∞. 
* 'l' - AppArmor —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª –∏ –∑–∞–ø—É—Å–∫. –†–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ñ–∞–π–ª–∞ —Ç–µ –∂–µ, —á—Ç–æ –∏ —É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ. 
* 'k' - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–∞.
* 'ux' - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–∞.
* 'Ux' - –ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–∏–∫–∞–∫ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è, –Ω–æ AppArmor –æ—á–∏—â–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –≤ –ø—É—Ç—è—Ö –∫ —Ä–∞–∑—Ä–µ—à–∞–µ–º—ã–º —Ä–µ—Å—É—Ä—Å–∞–º-—Ñ–∞–π–ª–∞–º:

* '*' - –õ—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–±—ã—Ö –∑–Ω–∞–∫–æ–≤, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Å–∏–º–≤–æ–ª–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ (/)
* '**' - –õ—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–±—ã—Ö –∑–Ω–∞–∫–æ–≤, –≤–∫–ª—é—á–∞—è —Å–∏–º–≤–æ–ª –∫–∞—Ç–∞–ª–æ–≥–∞ (/)
* '?' - –õ—é–±–æ–π –æ–¥–∏–Ω–æ—á–Ω—ã–π –∑–Ω–∞–∫, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Å–∏–º–≤–æ–ª–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ (/) 
* '[ ade ]' - –û–¥–∏–Ω –∏–∑ –∑–Ω–∞–∫–æ–≤: a, d –∏–ª–∏ e 
* '[ a-c ]' - –û–¥–∏–Ω –∏–∑ –∑–Ω–∞–∫–æ–≤: a, b –∏–ª–∏ c 
* '{ ab, cd }' - –õ–∏–±–æ ab, –ª–∏–±–æ cd

## –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è
–î–ª—è –∑–∞–ø—É—Å–∫–∞ /opt/Unigine_Superposition-1.1/Superposition
```
# Superposition GPU test AppArmor profile
# Copyright ¬© 2024 progserega
# License-Identifier: GPL3

#include <tunables/global>

profile superposition /opt/Unigine_Superposition-*/Superposition {
  #include <abstractions/fonts>
  #include <abstractions/X>
  #include <abstractions/audio>
  #include <abstractions/base>
  #include <abstractions/dri-common>
  #include <abstractions/dri-enumerate>
  #include <abstractions/mesa>
  #include <abstractions/nameservice>
  #include <abstractions/nvidia>
  #include <abstractions/vulkan>
  #include <abstractions/private-files-strict>

  network inet dgram,
  network inet stream,
  network inet6 dgram,
  network inet6 stream,

  /etc/libnl-*/classid r,
  /etc/machine-id r,
  /var/lib/dbus/machine-id r,
  @{PROC}/@{pid}/net/psched r,
  @{sys}/devices/system/cpu/{,**} r,
  # gpu:
  /usr/share/libdrm/** r,
  @{sys}/devices/pci*/**/hwmon/ r,
  @{sys}/devices/pci*/**/hwmon/** r,
  @{sys}/devices/pci*/**/*clk* r,
  @{sys}/devices/pci*/**/pp_dpm_pcie r,

  # udev device enumeration, input devices, video
  /etc/udev/udev.conf r,
  /run/udev/data/** r,
  @{sys}/bus/ r,
  @{sys}/class/ r,
  @{sys}/class/drm/ r,
  @{sys}/class/input/ r,
  @{sys}/class/sound/ r,
  @{sys}/devices/**/drm/** r,
  @{sys}/devices/**/input/** r,
  @{sys}/devices/**/sound/**/input*/** r,
  @{sys}/devices/**/sound/**/uevent r,
  @{sys}/devices/pci*/**/config r,
  @{sys}/devices/pci*/**/revision r,

  /opt/Unigine_Superposition-*/Superposition mrix,
  /opt/Unigine_Superposition-*/bin/* mrix,
  /opt/Unigine_Superposition-*/bin/qt/** mr,

  /opt/Unigine_Superposition-*/data/ r,
  /opt/Unigine_Superposition-*/data/** r,

  #/usr/bin/xdg-open mrix,

  owner @{HOME}/.Superposition/** rwk,
}

# vim:syntax=apparmor

```

=>../index.gmi üîô –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–∞—á–∞–ª—É...
