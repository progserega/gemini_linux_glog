# ะะฐะฑะพัะฐ ั lvm
## ะะฐัััะพะนะบะฐ LVM 
ะกะผ. ัะฐะบ ะถะต ะะฐะฑะพัะฐ ั ะฟัะพะณัะฐะผะผะฝัะผ RAID:
=>2025.01.25_mdraid.gmi ะะฐะฑะพัะฐ ั ะฟัะพะณัะฐะผะผะฝัะผ RAID

## ะะพะณะธะบะฐ 

## ะัะพัะผะพัั ะธะฝัะพัะผะฐัะธะธ
### ะัะฐัะบะพะต ะพะฟะธัะฐะฝะธะต
ะะฟะธัะฐะฝะธะต ะณััะฟะฟ:
```
vgs
```
ะะฟะธัะฐะฝะธะต ะปะพะณะธัะตัะบะธั ัะฐะทะดะตะปะพะฒ:
```
lvs
```
ะะฟะธัะฐะฝะธะต ัะธะทะธัะตัะบะธั ัะฐะทะดะตะปะพะฒ:
```
pvs
```

### ะะฝัะพัะผะฐัะธั ะพ dm-X
ะงัะพะฑั ัะทะฝะฐัั, ััะพ ัะฐะบะพะต /dev/dm-0 ะธะปะธ ะธะฝะพะต, ะฝัะถะฝะพ ะดะฐัั ะบะพะผะฐะฝะดั:
```
dmsetup info /dev/dm-0
```

### ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต
ะะฟะธัะฐะฝะธะต ะณััะฟะฟ:
```
vgdisplay
```
ะะฟะธัะฐะฝะธะต ะปะพะณะธัะตัะบะธั ัะฐะทะดะตะปะพะฒ:
```
lvdisplay
```
ะะฟะธัะฐะฝะธะต ัะธะทะธัะตัะบะธั ัะฐะทะดะตะปะพะฒ:
```
pvdisplay
```


## ะะทะผะตะฝะตะฝะธะต ัะฐะทะผะตัะฐ

ะะพะฟัััะธะผ ะฝะฐะผ ะฝัะถะฝะพ ะธะทะผะตะฝะธัั ะปะพะณะธัะตัะบะธะน ัะฐะทะดะตะป **root** ะฒ ะณััะฟะฟะต ัะฐะทะดะตะปะพะฒ **pve** ะธ ัะดะตะปะฐัั ะตะณะพ ัะฐะทะผะตัะพะผ 10 ะะฑ:
```
lvresize -r -L10G /dev/pve/root
```
ะะดะต:
* ''-r'' - ััะพ ะบะพะผะฐะฝะดะฐ, ะฟัะตะดะฟะธััะฒะฐััะฐั ะทะฐะฟัััะธัั ัะพะพัะฒะตัััะฒัััะธะต ััะธะปะธัั ะดะปั ะธะทะผะตะฝะตะฝะธั ัะฐะนะปะพะฒะพะน ัะธััะตะผั ะฝะฐ ัะฐะทะดะตะปะต (ััะพ ะพัะตะฝั
* ัะดะพะฑะฝะพ)
* ''-L10G'' - ัะฐะทะผะตั 10 ะะธะฑ (ะพัะฝะพะฒะฐะฝะธะต 10), ััะพะฑั ัะดะตะปะฐัั 10 ะะฑ (ะพัะฝะพะฒะฐะฝะธะต 2), ะฝัะถะฝะพ ัะบะฐะทะฐัั ัะฐะบ: ''-L10g''
* ะงัะพะฑั ัะบะฐะทะฐัั ะธัะฟะพะปัะทะพะฒะฐัั ะฒัั ัะฒะพะฑะพะดะฝะพะต ะผะตััะพ, ะฝัะถะฝะพ ะฟะตัะตะดะฐัั ะฟะฐัะฐะผะตััั: ''-l 100%FREE''
### ะฃะฒะตะปะธัะตะฝะธะต ะปะพะณะธัะตัะบะพะณะพ ัะฐะทะดะตะปะฐ
### ะฃะผะตะฝััะตะฝะธะต ะปะพะณะธัะตัะบะพะณะพ ัะฐะทะดะตะปะฐ

## ะกะพะทะดะฐะฝะธะต LVM ะฟะพะฒะตัั ัะฐะนะปะพะฒ
ะะทััะพ ััั:
=>http://help.ubuntu.ru/wiki/lvm

ะัะฐะฒะธะผ ัะธะปัััั LVM ะฒ ัะฐะนะปะต ''/etc/lvm/lvm.conf'', ะดะพะฑะฐะฒะปัั ะฟะพะธัะบ LVM ะฒ ัะพะผ ัะธัะปะต ะธ ะฝะฐ
=>http://help.ubuntu.ru/wiki/loop loop-ััััะพะนััะฒะฐั:
```
filter # [ "r|/dev/nbd.*|", "a/.*/" , "a/loop/" ]
```
ะกะพะทะดะฐัะผ ะฟััััะต ัะฐะนะปั:
```
mkdir /mnt/sdc1/lvm
cd /mnt/sdc1/lvm
dd if#/dev/zero of#./d01 count#1 bs#1G
dd if#/dev/zero of#./d02 count#1 bs#1G
dd if#/dev/zero of#./d03 count#1 bs#1G
dd if#/dev/zero of#./d04 count#1 bs#1G
```
ะกะพะทะดะฐะตะผ loopback ััััะพะนััะฒะฐ ะธะท ัะฐะนะปะพะฒ:
```
losetup -f --show ./d01
losetup -f --show ./d02
losetup -f --show ./d03
losetup -f --show ./d04
```
ะะฐะปััะต ะฟะพัััะฟะฐะตะผ ัะฐะบ ะถะต, ะบะฐะบ ะตัะปะธ ะฑั ะผะธ ัะพะทะดะฐะฒะฐะปะธ LVM ะฝะฐ ัะตะฐะปัะฝัั ะดะธัะบะฐั. ะะฑัะฐัะธัะต ะฒะฝะธะผะฐะฝะธะต ะฝะฐ ะฝะฐะทะฒะฐะฝะธั loop-ััััะพะนััะฒ โ
ะพะฝะธ ะผะพะณัั ะพัะปะธัะฐัััั ะพั ะฟัะธะฒะตะดัะฝะฝัั ะทะดะตัั.
```
pvcreate /dev/loop0
pvcreate /dev/loop1
pvcreate /dev/loop2
```

## ะัะบะฐะฟ ั ะฟะพะผะพััั ัะฝะฐะฟัะพัะพะฒ
ะะตัะตะด ัะตะผ ะบะฐะบ ะฒะฝะพัะธัั ะบะฐะบะธะต-ัะพ ะฒะฐะถะฝัะต ะธะทะผะตะฝะตะฝะธั ะฒ ัะธััะตะผั, ะฝะฐะฟัะธะผะตั ะพะฑะฝะพะฒะปะตะฝะธะต - ะผะพะถะฝะพ ัะดะตะปะฐัั ะฑัะบะฐะฟ ั ะฟะพะผะพััั
ัะฝะฐะฟัะพัะพะฒ:
```
sync
lvcreate -s -n root_before_update -L20G /dev/vg_root/root
```
ะก ััะพะณะพ ะผะพะผะตะฝัะฐ ะฒัั ัะฐะทะฝะธัะฐ ะผะตะถะดั ัะตะบััะธะผ ัะพััะพัะฝะธะตะผ /dev/vg_root/root ะธ ัะพััะพัะฝะธะตะผ /dev/vg_root/root ะฝะฐ ะผะพะผะตะฝั ัะพะทะดะฐะฝะธั
ัะฝะฐะฟัะพัะฐ ะฟะพะผะตัะฐัััั ะฒ ะฝะพะฒัะน ะปะพะณะธัะตัะบะธะน-ะดะธัะบ-ัะฝะฐะฟัะพั /dev/vg_root/root_before_update. ะะณะพ ะผะพะถะฝะพ ะฟัะธะผะพะฝัะธัะพะฒะฐัั ะธ ะฑัะฐัั ั
ะฝะตะณะพ ะดะฐะฝะฝัะต.

ะ ัะปััะฐะต, ะตัะปะธ ะพะฑะฝะพะฒะปะตะฝะธะต ะฑัะปะพ ะฝะตััะฟะตัะฝัะผ ะธ ะฝะตะพะฑัะพะดะธะผะพ ะพัะบะฐัะธัััั ะฝะฐ ัะพััะพัะฝะธะต ะฝะฐ ะฒัะตะผั ัะพะทะดะฐะฝะธั ัะฝะฐะฟัะพัะฐ, ะฝัะถะฝะพ
ะฟัะธะผะตะฝะธัั ะดะฐะฝะฝัะน ัะฝะฐะฟัะพั ะบ ะปะพะณะธัะตัะบะพะผั ะดะธัะบั, ั ะบะพัะพัะพะณะพ ะพะฝ ะฑัะป ัะดะตะปะฐะฝ:
```
lvconvert --merge /dev/vg_root/root_before_update
```
ะ ัะปััะฐะต, ะตัะปะธ ัะฐะทะดะตะป, ะบ ะบะพัะพัะพะผั ะฟัะธะผะตะฝัะตััั ัะฝะฐะฟัะพั ะฒ ะดะฐะฝะฝัะน ะผะพะผะตะฝั ะธัะฟะพะปัะทัะตััั (ะฝะฐะฟัะธะผะตั ะฒ ัะปััะฐะต root-ัะฐะทะดะตะปะฐ), ัะพ
ัะฝะฐะฟัะพั ะฟัะธะผะตะฝะธััั ะฒ ะผะพะผะตะฝั ะฟะตัะตะทะฐะณััะทะบะธ ัะธััะตะผั.
```
reboot
```
ะ ัะปััะฐะต, ะตัะปะธ ัะธััะตะผะฐ ะฟะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั ะธะปะธ ะฟะพัะปะต rm -rf /* ัะพะฒัะตะผ ะฝะต ะพะถะธะฒะฐะตั ะธ ะฑะฐะฝะฐะปัะฝะพ ะฝะตัะตะผ ะฟัะธะผะตะฝััั ัะฝะฐะฟัะพั, ะดะปั
ะพัะบะฐัะฐ ะธะทะผะตะฝะตะฝะธะน, ัะพ ะผะพะถะฝะพ ะทะฐะณััะทะธัััั ั livecd, ะฟะพะดะฝััั lvm ะธ md (ะตัะปะธ ะฝะตะพะฑัะพะดะธะผะพ) ะธ ัะถะต ัะฐะผ ะฟัะธะผะตะฝะธัั ัะฝะฐะฟัะพั.

ะะะะะะงะะะะ:
ะัะธะผะตะฝะตะฝะธะต ัะฝะฐะฟัะพัะฐ - ะผะพะถะตั ะฑััั ะพัะปะพะถะตะฝะฝะพะน ะพะฟะตัะฐัะธะตะน, ะบะพัะพัะฐั ะฟัะพะดะพะปะถะธััั ะฟะพัะปะต ะฟะตัะตะทะฐะณััะทะบะธ ัะธััะตะผั. ะะพะฝะธัะพัะธะฝะณ ะฟัะธะผะตะฝะตะฝะธั
ัะฝะฐะฟัะพัะฐ ะผะพะถะฝะพ ะพััะปะตะถะธะฒะฐัั ะบะพะผะฐะฝะดะพะน:
```
dmsetup status vg_root/root_deb
```
ะะดะต:
* vg_root/root_deb - ะณััะฟะฟะฐ/ะปะพะณะธัะตัะบะธ_ะดะธัะบ, ะฝะฐ ะบะพัะพััะน ะฝะฐะบะฐััะฒะฐะตััั ัะฝะฐะฟัะพั

ะ ะฒัะฒะพะดะต ะฑัะดะตั:
```
0 125829120 snapshot-merge 1922376/125829120 7488
```
ะะดะต:
* 7488 - ัะบะพะปัะบะพ ะพััะฐะปะพัั (ะฑะปะพะบะพะฒ?) ะดะปั ะฟัะธะผะตะฝะตะฝะธั ัะฝะฐะฟัะพัะฐ. ะฆะธััั ัะผะตะฝััะฐัััั ั ะบะฐะถะดัะผ ัะฐะทะพะผ.

ะ ัะปััะฐะต, ะตัะปะธ ะบะพัะตะฝั ะฑัะป ะฟะพะฒะตั ะฟัะพะณัะฐะผะผะฝะพะณะพ ัะตะนะดะฐ - ะพะฝ ะผะพะถะตั ะฝะฐัะฐัั ะฟะตัะตัะพะฑะธัะฐัััั ะฟะพัะปะต ะฟะตัะตะทะฐะณััะทะบะธ.

ะัะปะธ ะถะต ัะฝะฐะฟัะพั ะฝะต ะฟัะธะณะพะดะธะปัั ะธ ะฑะพะปััะต ะฝะต ะฝัะถะตะฝ, ัะพ ะผะพะถะฝะพ ัะดะฐะปะธัั ะตะณะพ:
```
lvremove /dev/vg_root/root_before_update
```


## ะะฐะผะตะฝะฐ ัะธะทะธัะตัะบะพะณะพ ะดะธัะบะฐ/ะผะธะณัะฐัะธั ะดะฐะฝะฝัั ะฒ LVM
### ะะธะณัะฐัะธั ะดะฐะฝะฝัั
ะัะปะธ ะฝัะถะฝะพ ัะฑัะฐัั ะธะท ะปะพะณะธัะตัะบะพะน ะณััะฟะฟั ะธัะฟะพะปัะทัะตะผัะน ัะธะทะธัะตัะบะธะน ะดะธัะบ (ะฝะฐะฟัะธะผะตั /dev/sda1), ัะพ ะฝัะถะฝะพ:
ะฟะตัะตะฝะตััะธ ั ะฝะตะณะพ ะดะฐะฝะฝัะต ะฝะฐ ะดััะณะพะน ัะธะทะธัะตัะบะธะน ะดะธัะบ 
```
pvmove /dev/sda1
```
ะฒ ะดะฐะฝะฝะพะผ ัะปััะฐะต ะดะฐะฝะฝัะต ั sda1
ะฟะตัะตะผะตัััััั ะฝะฐ ะดััะณะธะต ะดะธัะบะธ, ะดะพัััะฟะฝัะต ะฒ ะปะพะณะธัะตัะบะพะน ะณััะฟะฟะต.
ะัะธะผะตัะฐะฝะธะต:
ะฟะตัะตะด `pvmove` ะฝะตะพะฑัะพะดะธะผะพ ัะดะฐะปะธัั ะฒัะต ัะฝะฐะฟัะพัั:
```
lvremove vg_root/root_snap
```
ัะฑัะฐัั ัะธะทะธัะตัะบะธะน ะดะธัะบ ะธะท ะปะพะณะธัะตัะบะพะน ะณััะฟะฟั: 
```
vgreduce vg_root /dev/sda1
```
### ะะธะณัะฐัะธั root-ัะฐะทะดะตะปะฐ
ะ ัะปััะฐะต, ะตัะปะธ root-ะบะฐะทะดะตะป ัะฐัะฟะพะปะพะถะตะฝ ะฟะพะฒะตัั lvm, ัะพ ะฝัะถะฝะพ ะฝะต ะทะฐะฑััั ะพะฑะฝะพะฒะธัั ะบะพะฝัะธะณััะฐัะธะธ ะทะฐะณััะทะบะธ:
ะ ัะปััะฐะต, ะตัะปะธ lvm ัััะฐะฝะพะฒะปะตะฝ ะดะพะฟะพะปะฝะธัะตะปัะฝะพ ะตัั ะธ ะฟะพะฒะตัั 
=>glog/2025.01.25_mdraid.gmi RAID
ัะพ ะฝัะถะฝะพ
ะพะฑะฝะพะฒะธัั ะบะพะฝัะธะณััะฐัะธั ัะตะนะดะฐ: 
```
mdadm --detail --scan >> /etc/mdadm/mdadm.conf
```
ะฟัะตะดะฒะฐัะธัะตะปัะฝะพ ัะฑัะฐะฒ
ะพัััะดะฐ ััะฐััะต ัััะพะบะธ ะฟัะพ **ARRAY**
* ะะฑะฝะพะฒะปัะตะผ initrd-ะพะฑัะฐะทั: 
```
update-initrd -u
```
* ะฟะตัะตะณะตะฝะตัะธััะตะผ ะบะพะฝัะธะณ:
```
dpkg-reconfigure grub-pc
```
* ัััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะณััะทะบัะธะบ ะฝะฐ ะดะธัะบ, ั ะบะพัะพัะพะณะพ ะฑัะดะตั ะณััะทะธััั ัะตัะฒะตั: 
```
grub-install --recheck /dev/sda
```
ะัะธะผะตัะฐะฝะธะต:
ะฒะพะทะผะพะถะฝะพ, ััะพะฑั grub ัะดะฐัะฝะพ ะทะฐะณััะทะธะป ะบะพัะตะฝั, ะฝัะถะฝะพ, ััะพะฑั ะดะฐะฝะฝัะต ะบะพัะฝั
(ะบะฐะบ ะผะธะฝะธะผัะผ ัะดัะพ ะธ initrd-ะพะฑัะฐะท) ะฑัะปะธ ะฝะฐ ัะพะผ ะดะธัะบะต, ั ะบะพัะพัะพะณะพ ะณััะทะธััั ัะธััะตะผะฐ. ะะปั ััะพะณะพ,
ะฒะพะทะผะพะถะฝะพ, ะฟัะธะดัััั ะดะพะฟะพะปะฝะธัะตะปัะฝะพ ะฒ ััะพะผ ัะดะพััะพะฒะตัะธัััั, ะผะธะณัะธัะพะฒะฐะฒ ะดะฐะฝะฝัะต ะบะพัะฝั ะฝะฐ ััะพั ะดะธัะบ, ะปะธะฑะพ ะฝะฐ
=>glog/2025.01.25_mdraid.gmi RAID
, ะตัะปะธ ะทะฐะณััะทะพัะฝัะน ะดะธัะบ ัะฒะปัะตััั ัะฐัััั ััะพะณะพ ัะตะนะดะฐ.
ะะฐะฟัะธะผะตั:
```
pvmove -n vg_root/root /dev/md1 /dev/md0
```
ะะดะต:
* vg_root/root - ะปะพะณะธัะตัะบะธะน ะดะธัะบ LVM ั ะบะพัะฝะตะผ ัะธััะตะผั
* /dev/md1 - ัะธะทะธัะตัะบะพะต ััััะพะนััะฒะพ LVM (ะฒ ัะพััะฐะฒะต ะณััะฟะฟั ัะพะผะพะฒ vg_root), ััะฐะฝััะตะต ะดะฐะฝะฝัะต
* ะปะพะณะธัะตัะบะพะณะพ ะดะธัะบะฐ root ะฒ ะดะฐะฝะฝัะน ะผะพะผะตะฝั
* /dev/md0 - ัะธะทะธัะตัะบะพะต ััััะพะนััะฒะพ LVM (ะฒ ัะพััะฐะฒะต ะณััะฟะฟั ัะพะผะพะฒ vg_root), ัะพััะพััะตะต ะฒ ัะพะผ ัะธัะปะต ะธ
* ะธะท /dev/sda, ั ะบะพัะพัะพะณะพ ะฟัะพะธััะพะดะธั ะทะฐะณััะทะบะฐ ัะธััะตะผั



## ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ
### ะะพะฝัะธัะพะฒะฐะฝะธะต ัะฐะทะดะตะปะฐ ะพะฑัะฐะทะฐ
ะะทััะพ
=>http://dark123us.wordpress.com/2011/02/08/kvm-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D1%81-lvm-%D0%B4%D0%B8%D1%81%D0%BA%D0%BE%D0%BC/ ััั
ะกะผะพััะธะผ ัะฐัะฟะพะปะพะถะตะฝะธะต ัะฐะทะดะตะปะพะฒ ะฝะฐ ะดะธัะบะต

```
# parted hda.img
GNU Parted 1.7.1
Using /data/rabbit/disk_image/test2
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) unit
Unit?  [compact]? B
(parted) print
Disk /data/rabbit/disk_image/test2: 10262568959B
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Number  Start        End           Size         Type     File system  Flags
1      32256B       106928639B    106896384B   primary  ext3         boot
2      106928640B   1184440319B   1077511680B  primary  linux-swap
3      1184440320B  10256924159B  9072483840B  primary  ext3
(parted) quit
```
ะะพะปััะฐะตะผ ะฐะดัะตัะฐ, ะณะดะต ะฝะฐัะธะฝะฐัััั ัะฐะทะดะตะปั, ะผะพะฝัะธััะตะผ ะฒ ัะพะพัะฒะตัััะฒะธะธ ั ะฟะพะปััะตะฝะฝะพะน ะธะฝัะพัะผะฐัะธะตะน
```
mount -o loop,ro,offset#32256 hda.img /mnt/rabbit
```

ะัะธ ะผะพะฝัะธัะพะฒะฐะฝะธะธ ะฒัะพัะพะณะพ ะดะธัะบะฐ ะฟัะพะธะทะพัะปะฐ ะพัะธะฑะบะฐ
```
#umount /mnt/rabbit
#mount -o loop,ro,offset#1184440320 test2 /mnt/rabbit
#mount: wrong fs type, bad option, bad superblock on /dev/loop0,
missing codepage or helper program, or other error
In some cases useful info is found in syslog - try
dmesg | tail  or so
#dd if#hda.img of#hda3.img bs#512 skip#2313360 count#17719695
17719695+0 records in
17719695+0 records out
9072483840 bytes (9.1 GB) copied, 485.679 seconds, 18.7 MB/s
```
ะะพััะพะผั ัะตัะฐะตะผ โ ะบะพะฟะธััะตะผ ัะฐะทะดะตะป ัะพ ัะผะตัะตะฝะธัะผะธ, ัะบะฐะทัะฒะฐั ัะฐะทะผะตั ะฑะปะพะบะฐ ะธ ัะบะพะปัะบะพ ะฑะปะพะบะพะฒ
ะฝะตะพะฑัะพะดะธะผะพ
ะะพะฝัะธััะตะผ

```
# mount -o loop hda3.img /mnt/rabbit/
# df -h /mnt/rabbit
Filesystem            Size  Used Avail Use% Mounted on
/data/rabbit/image/hda3.img
8.4G  6.3G  1.7G  80% /mnt/rabbit
```


## ะะฐัััะพะนะบะฐ lvm cache ะฝะฐ nvme ะฒ ัะพะผ ัะธัะปะต ะดะปั root-ัะฐะทะดะตะปะฐ  
### ะะพะณะธะบะฐ ัะฐะฑะพัั

=>https://www.it-world24.ru/programmy/lvm-cache-prozrachnoe-keshirovanie-hdd-ispolzuya-ssd.html

### ะะพะณะธะบะฐ
* ะะตััะผ ะฑัััััะน ะดะธัะบ nvme/ssd.
* ะะพะฑะฐะฒะปัะตะผ ะตะณะพ ะฒะตัั ะฒ lvm-ะณััะฟะฟั, ะฒ ะบะพัะพัะพะน ะฑัะดะตะผ ะบััะธัะพะฒะฐัั ะปะพะณะธัะตัะบะธะน ัะฐะทะดะตะป.
* ัะพะทะดะฐัะผ ัะฐะทะดะตะป ะบััะฐ ะธ ะผะตัะฐะดะฐะฝะฝัั ะบััะฐ ะฝะฐ ััะพะผ pv
* ะฟะพะดะบะปััะฐะตะผ ััะธ ัะฐะทะดะตะปั ะบ ะบััะธััะตะผะพะผั lv
* ัะฐะทะดะตะป ะบััะฐ ะผะพะถะตั ะฑััั ะผะตะฝััะต ะบััะธััะตะผะพะณะพ lv

### ะะพะดะณะพัะฐะฒะปะธะฒะฐะตะผ ัะธััะตะผั
ะะพะฑะฐะฒะปัะตะผ ะฒะตัั ssd ะฒ lvm-ะณััะฟะฟั, ะบะพัะพััั ะฑัะดะตะผ ะบััะธัะพะฒะฐัั (ะฒ ะฝะฐัะตะผ ัะปััะฐะต vg_root):
```
lvcreate -n root_cache_metadata -L600M vg_root /dev/nvme0n1
```

## ะกะพะฑััะฒะตะฝะฝะพ ัะพะทะดะฐัะผ lvm cache:
```
lvcreate -n root_cache_metadata -L600M vg_root /dev/nvme0n1
lvcreate -n root_cache_data -L60G vg_root /dev/nvme0n1
lvconvert --type cache-pool --cachemode writeback --poolmetadata vg_root/root_cache_metadata  vg_root/root_cache_data
lvconvert --type cache --cachepool vg_root/root_cache_data vg_root/root_deb
```

### ะฝะฐัััะฐะธะฒะฐะตะผ ะพะฟัะธะธ ัะดัะฐ:
ะฒ /etc/default/grub ะฟัะฐะฒะธะผ ะฟะฐัะฐะผะตัั ะพะฟัะธะน ัะดัะฐ:
```
GRUB_CMDLINE_LINUX#"rd.md#1 rd.md.conf#1 rd.auto#1"
```

### ะะฐัััะฐะธะฒะฐะตะผ dracut:
```
apt-get isntall dracut
```
### ะะพะฑะฐะฒะปัะตะผ ะฝัะถะฝัะต ะผะพะดัะปะธ:
ะกะพะทะดะฐัะผ ัะฐะนะป ะทะฐะณััะทะบะธ ะผะพะดัะปะตะน /etc/dracut.conf.d/lvm.conf ั ัะพะดะตัะถะธะผัะผ (ะพะฑัะทะฐัะตะปัะฝะพ ะฒะพะบััะณ ะธะผะตะฝะธ ะผะพะดัะปั - ะฟัะพะฑะตะปั):
```
# support lvm root:
add_dracutmodules+#" lvm "
```
ะกะพะทะดะฐัะผ ัะฐะนะป ะทะฐะณััะทะบะธ ะผะพะดัะปะตะน /etc/dracut.conf.d/mdadm.conf ั ัะพะดะตัะถะธะผัะผ (ะพะฑัะทะฐัะตะปัะฝะพ ะฒะพะบััะณ ะธะผะตะฝะธ ะผะพะดัะปั - ะฟัะพะฑะตะปั):
```
# support mdadm root:
add_dracutmodules+=" mdraid "
```

### ะะตัะตัะพะฑะธัะฐะตะผ initramfs-ะพะฑัะฐะทั ะดะปั ะฒัะตั ัะดะตั

ะกะผะพััะธะผ ะบะฐะบะธะต ะผะพะดัะปะธ ะตััั (ะดะปั ะบะฐะบะธั ัะดะตั):
```
ls /lib/modules
```
ะะตัะตัะพะฑะธัะฐะตะผ:

```
dracut /boot/initrd.img-6.1.0-13-amd64 6.1.0-13-amd64 --force
dracut /boot/initrd.img-6.1.0-15-amd64 6.1.0-15-amd64 --force
```

## ะะฑะฝะพะฒะปัะตะผ ะฟะฐัะฐะผะตััั ะทะฐะณััะทะบะธ
ะะตัะตัะพะฑะธัะฐะตะผ ะบะพะฝัะธะณ ั ะฝะพะฒัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ ัะดัะฐ, ะฟัะพะฟะธััะฒะฐะตะผ ะฝะพะฒัะต initramfs, ะฟัะพะฟะธััะฒะฐะตะผ ะทะฐะณััะทะบั ะฒ ะฑะปะพัะฝัะต ััััะพะนััะฒะฐ:
```
dpkg-reconfigure grub-pc
```

### ะัะบะปััะตะฝะธะต ะบััะฐ

```
lvconvert --uncache vg_root/root_deb
```

## ะัะฐัะธัะตัะบะธะต ััะธะปะธัั ะดะปั ัะฐะฑะพัั ั LVM

* kvpm
* system-config-lvm

## ะกััะปะบะธ
=>http://habrahabr.ru/post/67283/ ะะฒะพะดะฝะฐั ะฝะฐ ััััะบะพะผ
=>http://xgu.ru/wiki/LVM ะะพะบัะผะตะฝัะฐัะธั ะฝะฐ ััััะบะพะผ
=>http://dark123us.wordpress.com/2011/02/08/kvm-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D1%81-lvm-%D0%B4%D0%B8%D1%81%D0%BA%D0%BE%D0%BC/ ะะพะฝัะธัะพะฒะฐะฝะธะต ัะฐะทะดะตะปะพะฒ ะพะฑัะฐะทะฐ (ั ะฟะพะผะพััั ะพะฟัะธะธ mount - offset)
=>http://help.ubuntu.ru/wiki/lvm ะกะพะทะดะฐะฝะธะต LVM ะฟะพะฒะตัั ะพะฑััะฝัั ัะฐะนะปะพะฒ

#>../index.gmi ๐ ะฒะตัะฝััััั ะบ ะฝะฐัะฐะปั...
